{% extends "datalocker/main_template.html" %}
{% load staticfiles %}

{% block page-meta-title %}Submissions{% endblock page-meta-title %}

{% block content %}
    <div class="container-fluid">
    <ol class="breadcrumb">
        <li><a href="{% url 'datalocker:index' %}"><span class="sr-only">List of </span>My Lockers</a></li>
        <li class="active">All Submissions<span class="sr-only"> for {{ locker.name }}</span></li>
    </ol>
        <h1>{{ locker.name }}</h1>
        <button type="button" class="btn btn-info btn-sm" role="filter-results">Fields</button>
        <table class="table table-striped table-hover listing" name="submission listing">
            <caption>Form Submissions</caption>
            <thead>
              {% for heading in column_headings %}
                <th>{{ heading }}</th>
              {% endfor %}
            </thead>
            <tbody>
              {% for submission in data %}
                <tr>
                  {% for value in submission %}
                    {% if forloop.counter > 1 %}
                      <td>
                        {% if forloop.counter == 2 %}
                          <a href="{% url 'datalocker:submissions_view' locker.id submission.0 %}"
                           >{{ value }}</a>
                        {% else %}
                          {{ value }}
                        {% endif %}
                      </td>
                    {% endif %}
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
        </table>
      </div>
{% endblock %}


{% block dialogs %}
<!-- Modal for filtering out the data shown in the submission list -->
  <div class="modal fade" id="dialog-filterResults" tabindex="-1" role="dialog" aria-labelledby="dialog-filerResults-title" aria-hidden="true">
    <form method="POST" name="modalForm" action="{% url 'datalocker:submissions_list' locker.id %}">
      {% csrf_token %}
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title" id="dialog-filterResults-title">Fields to display </h4>
          </div>
          <div class="modal-body">
            {% for field in fields_list %}
            <input type="checkbox" id="{{ field|slugify }}" value="checked" name="{{ field|slugify }}"/> <label for="{{ field|slugify }}">{{ field }}</label><br />
            {% endfor %}
          </div>
          <div class="modal-footer">
            <input type="submit" class="btn btn-primary btn-sm save-button" />
            <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </form>
  </div>
{% endblock %}

{% block site-scripts %}
    {{ block.super }}
    <!-- JavaScript code to run the modal into the page when the button
    is pressed -->
    <script type="text/javascript">
      $(document).ready(function (){
        $("button[role='filter-results']").on("click", function (event){
          $("#dialog-filterResults").modal('show');
        });
      });
    </script>
{% endblock site-scripts %}

