{# Copyright 2015 The Pennsylvania State University. Office of the Vice Provost for Educational Equity. All Rights Reserved. #}
{% extends "datalocker/main_template.html" %}
{% load staticfiles %}

{% block page-meta-title %}Submissions{% endblock page-meta-title %}

{% block content %}
    <div class="container-fluid">
    {% if user.is_authenticated %}
      <ol class="breadcrumb">
        <li>
          <a href="{% url 'datalocker:index' %}">
          <span class="sr-only">List of </span>My Lockers</a>
        </li>
        <li class="active">All Submissions
          <span class="sr-only"> for {{ locker.name }}</span>
        </li>
        <div style="float:right; margin-top:0;">
        </div>
      </ol>
      <h1 style="float:left;">{{ locker.name }}</h1>
     {% if locker.owner = user.username %}
        <div class="onoffswitch">
          <input type="checkbox" name="onoffswitch"
            class="onoffswitch-checkbox" id="myonoffswitch" checked>
          <label class="onoffswitch-label" for="myonoffswitch">
              <span class="onoffswitch-inner"></span>
              <span class="onoffswitch-switch"></span>
          </label>
        </div>
       <div class="label_for_toggle">
        Maintenance Mode
       </div>
      {% endif %}
      <button type="button" class="btn btn-default btn-xs" role="filter-results">
        Fields to Display</button>
      <table class="table table-striped table-hover listing sortable"
        name="submission listing" id="submission-list">
        <caption>Form Submissions</caption>
        <thead>
          {% for heading in column_headings %}
            <th>{{ heading }}</th>
          {% endfor %}
        </thead>
        <tbody>
          {% for submission in data %}
            <tr data-id="{{submission.0 }}" locker-id="{{locker.id}}"
              class="{% if submission.1 %}deleted{% else %}{% endif %}">
              {% for value in submission %}
                {% if forloop.counter > 2 %}
                  <td>
                    {% if forloop.counter == 3 %}
                      <a href="{% url 'datalocker:submissions_view' locker.id submission.0 %}"
                        style="display:block;">{{ value }}</a>
                    {% else %}
                      {{ value }}
                    {% endif %}
                  </td>
                {% endif %}
              {% endfor %}
              <td>
                <button type="button" role="delete" class="delete-button">
                  {% if submission.1 %}Undelete{% else %}Delete{% endif %}</button>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <h4>Please <a href="/datalocker/admin/login/?next=/datalocker/">
        log in</a> to view the submissions for this locker</h4>
    {% endif %}
    </div>
    <form method="POST" id="delete_undelete_form">
     {% csrf_token %}
    </form>
{% endblock %}


{% block dialogs %}
<!-- Modal for filtering out the data shown in the submission list -->
  <div class="modal fade" id="dialog-filter-results" tabindex="-1"
    role="dialog" aria-labelledby="dialog-filter-results-title"
      aria-hidden="true">
    <form method="POST" name="modalForm"
      action="{% url 'datalocker:submissions_list' locker.id %}">
      {% csrf_token %}
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title" id="dialog-filter-results-title">
              Fields to display </h4>
          </div>
          <div class="modal-body">
            <div>
              <input type="checkbox" id="fields-select-all"
                role="select-all" data-target="fields-list"/>
              <label for="fields-select-all"  class="select-all-checkbox">
                Select All</label>
            </div>
            <ul class="list-unstyled" id="fields-list">
            {% for field in fields_list %}
              <li><input type="checkbox" id="{{ field|slugify }}"
                name="{{ field|slugify }}" class="checkbox-inputs"
                     {% if field in selected_fields %} checked="checked" {% endif %} />
              <label for="{{ field|slugify }}">{{ field }}</label></li>
            {% endfor %}
            </ul>
          </div>
          <div class="modal-footer">
            <input type="submit" class="btn btn-primary btn-sm save-button pull-left"
              value="Update"/>
            <button type="button" class="btn btn-default btn-sm pull-left"
              data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </form>
  </div>
{% endblock %}

{% block site-scripts %}
    {{ block.super }}
    <!-- JavaScript code to run the modal into the page when the button
    is pressed -->
    <script type="text/javascript">
      $(document).ready(function (){
        $("button[role='filter-results']").on("click", function (event){
          $("#dialog-filter-results").modal('show');
        });
        $('#submission-list').tablesorter();
      });
    </script>
    <script type="text/javascript"
            src=" {% static 'datalocker/js/tablesorter.js' %}"></script>
    <script type="text/javascript"
            src=" {% static 'datalocker/js/select-all.js' %}"></script>
    <script type="text/javascript"
            src=" {% static 'datalocker/js/submission.js' %}"></script>
{% endblock site-scripts %}


